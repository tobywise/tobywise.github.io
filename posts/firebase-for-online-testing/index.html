<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><script src=https://code.jquery.com/jquery-3.4.1.slim.min.js integrity=sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js integrity=sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js integrity=sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6 crossorigin=anonymous></script>
<link href="https://fonts.googleapis.com/css?family=Rubik:100,200,300,400" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Roboto:100,200,300,400" rel=stylesheet><link rel=preconnect href=https://fonts.gstatic.com><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Rufina:wght@700&family=Work+Sans:wght@100;300;400;500;600;700&Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700display=swap" rel=stylesheet><link rel=stylesheet type=text/css href=/css/bootstrap.min.css><link rel=stylesheet type=text/css href=/css/style.css><title>TOBY WISE | Running online experiments using Google Firebase</title></head><body><nav class="navbar sticky-top navbar-expand-lg navbar-light bg-light"><div class=container><a class="navbar-brand text-dark" href=/><div>TOBY WISE</div></a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><ul class="collapse navbar-collapse ml-auto w-100 justify-content-end" id=navbarNav style=margin:auto><a class="nav-item nav-link justify-content-end" href=www.tobywise.com/><a class=menu-entries href=www.tobywise.com/www.tobywise.com/>Home</a></a>
<a class="nav-item nav-link justify-content-end" href=www.tobywise.com/posts/><a class=menu-entries href=www.tobywise.com/www.tobywise.com/posts/>Posts</a></a>
<a class="nav-item nav-link justify-content-end" href=www.tobywise.com/about/><a class=menu-entries href=www.tobywise.com/www.tobywise.com/about/>About</a></a>
<a class="nav-item nav-link justify-content-end" href=www.tobywise.com/cv/><a class=menu-entries href=www.tobywise.com/www.tobywise.com/cv/>CV</a></a>
<a class="nav-item nav-link justify-content-end" href=www.tobywise.com/publications/><a class=menu-entries href=www.tobywise.com/www.tobywise.com/publications/>Publications</a></a>
<a class="nav-item nav-link justify-content-end" href=www.tobywise.com/research/><a class=menu-entries href=www.tobywise.com/www.tobywise.com/research/>Research</a></a>
<a class="nav-item nav-link justify-content-end" href=http://github.com/tobywise><a class=menu-entries href=http://github.com/tobywise><i data-feather=github></i></a></a>
<a class="nav-item nav-link justify-content-end" href=https://osf.io/dnwpx/><a class=menu-entries href=https://osf.io/dnwpx/><i class="ai ai-osf ai-2x" style=font-size:1.7em></i></a></a>
<a class="nav-item nav-link justify-content-end" href="https://scholar.google.co.uk/citations?user=_PD-jwIAAAAJ&hl=en"><a class=menu-entries href="https://scholar.google.co.uk/citations?user=_PD-jwIAAAAJ&hl=en"><i class="ai ai-google-scholar ai-2x" style=font-size:1.7em></i></a></a>
<a class="nav-item nav-link justify-content-end" href=https://twitter.com/toby_wise><a class=menu-entries href=https://twitter.com/toby_wise><i data-feather=twitter></i></a></a></ul></div></div></nav><div id=content><div class="container w-100 text-dark"><div class=container-bg><h1>Running online experiments using Google Firebase</h1><i data-feather=calendar></i>
<time datetime=2019-08-20>Aug 20, 2019</time>
<i data-feather=tag></i>
<a class="btn btn-sm btn-outline-primary text-dark tag-btn" href=www.tobywise.com/tags/blog>blog</a>
<a class="btn btn-sm btn-outline-primary text-dark tag-btn" href=www.tobywise.com/tags/online>online</a>
<a class="btn btn-sm btn-outline-primary text-dark tag-btn" href=www.tobywise.com/tags/coding>coding</a><br><br><p>Online testing is becoming a popular way of running psychological experiments. Services such as <a href=www.prolific.co>Prolific</a> allow large samples to be recruited and tested in a matter of hours.</p><p>However one aspect of this process that often has people confused is how exactly to host a task online and store data properly. Some services are available that make this straightforward, such as <a href=https://gorilla.sc/>Gorilla</a>, however many of us want flexibility beyond that provided by these services.</p><p>After trying many ways of running tasks online, I&rsquo;ve settled on a method that works well for me, which uses Google&rsquo;s Firebase services. I thought it might be helpful to share how exactly this works to make it easier for others to get these things set up, and to reduce the number of confused messages I&rsquo;m receiving on Slack from <a href=https://twitter.com/evanrussek>Evan</a>.</p><h2 id=introduction-to-firebase>Introduction to Firebase</h2><p>Firebase is a suite of database, authentication, and hosting services provided by Google. It&rsquo;s primarily designed for mobile/web apps, but its ease of use and range of unified features make it a great way to host tasks online and deal with data that they generate.</p><p>Firebase is <a href=https://firebase.google.com/support/privacy>GDPR-compliant</a> and provides multiple data storage locations, along with ways to restrict access to the database to ensure that it&rsquo;s not accessed by people who shouldn&rsquo;t have access.</p><p>Firebase is a paid service, but is free up to a certain point (dictated by daily/weekly usage) - for most tasks it&rsquo;s likely to cost nothing.</p><p>There are two services provided by Firebase that are useful for us:</p><ul><li>Database</li><li>Hosting</li></ul><p>I will go through how to set up each of these in turn.</p><h2 id=setting-up-firebase>Setting up Firebase</h2><p><img src=../../img/firebase_start.png alt></p><p>The first thing you&rsquo;ll need to do is open a Google account, if you haven&rsquo;t already got one. You can then go to <a href=https://firebase.google.com/>https://firebase.google.com/</a> where you&rsquo;ll be given the option to create a project.</p><p>You&rsquo;ll then be taken through a couple of steps:</p><h3 id=name-your-project>Name your project</h3><p>Choose a name for the project you&rsquo;ll be working on - you have have multiple projects.</p><h3 id=google-analytics>Google analytics</h3><p>We don&rsquo;t need any of these services, so you can say no to this.</p><p><img src=../../img/firebase_project_ready.png alt></p><p>Once this is done you&rsquo;ll be able to open your project!</p><h2 id=setting-up-the-database>Setting up the database</h2><p>Now, you can click on the <strong>develop</strong> option on the menu on the left of the screen to access the various tools you&rsquo;ll need. First, choose the database option.</p><p>Next, click on <strong>create database</strong>. You&rsquo;ll be asked to choose your security rules. For now, choose <strong>Start in test mode</strong>. We&rsquo;ll be changing these rules later anyway, and this will make it simpler for you to to test things.</p><p>Then, choose your data storage location. This will depend on your circumstances, but if you&rsquo;re dealing with GDPR in any way it&rsquo;s best to choose Europe.</p><p>After a minute or so, you&rsquo;ll have a database set up.</p><blockquote><p><strong><em>Note:</em></strong> Firebase provides two types of databases, Cloud Firestore and Realtime database. Make sure you&rsquo;re using Cloud Firestore.</p></blockquote><h3 id=how-the-database-works>How the database works</h3><p>Firebase uses noSQL style databases. This means that they&rsquo;re not set up in a rows & columns format, and instead use a hierarchical structue consisting of what firebase calls <strong>collections</strong> and <strong>documents</strong>.</p><p>A <strong>collection</strong> contains multiple documents, but no data itself.</p><p>A <strong>document</strong> can contain two things: <strong>fields</strong> and more <strong>collections</strong>.</p><p><strong>Fields</strong> are where your data itself is stored.</p><p><img src=../../img/firebase_rules.png alt></p><p>The way I&rsquo;ve typically structured my data is as follows:</p><p>I have a collection called tasks, with one document for each task I&rsquo;m running. Within each document I have a fields representing information about the task, and then a collection called &ldquo;subjects&rdquo; that contains a separate document for each subject.</p><p>This subject document contains fields with their subject ID, date they completed the task, and any other relevant variables for the subject. The subject&rsquo;s document also contains collections, for example a separate collection for each trial. The fields within these sub-collections will then contain their responses for that trial.</p><h3 id=security-rules>Security rules</h3><p>If you click on the <strong>rules</strong> tab on the database section of the firebase website, you&rsquo;ll see options for restricting access to the database. This is important for two reasons:</p><ol><li>Security - we don&rsquo;t want people accessing the data if they shouldn&rsquo;t.</li><li>Data integrity - we need to ensure that we don&rsquo;t overwrite or delete data when multiple subjects complete the task. Each subject should only modify their own data.</li></ol><p>To achieve this, we set up a system where each subject completing the task is assigned an anonymous ID which identifies them within the database. Access to the database is then restricted based on this ID - data is only written to the database if the ID given in the write request matches the record that is trying to be modified.</p><p>This is what we use the <strong>rules</strong> section for. Below is what I then use in this section.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>service</span> <span style=color:#a6e22e>cloud</span>.<span style=color:#a6e22e>firestore</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>match</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>databases</span><span style=color:#f92672>/</span>{<span style=color:#a6e22e>database</span>}<span style=color:#f92672>/</span><span style=color:#a6e22e>documents</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>match</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>tasks</span><span style=color:#f92672>/</span><span style=color:#a6e22e>new_task</span><span style=color:#f92672>/</span><span style=color:#a6e22e>subjects</span><span style=color:#f92672>/</span>{<span style=color:#a6e22e>userId</span>} {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>allow</span> <span style=color:#a6e22e>read</span>, <span style=color:#a6e22e>update</span>, <span style=color:#66d9ef>delete</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>uid</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>userId</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>allow</span> <span style=color:#a6e22e>create</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>uid</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>match</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>tasks</span><span style=color:#f92672>/</span><span style=color:#a6e22e>new_task</span><span style=color:#f92672>/</span><span style=color:#a6e22e>subjects</span><span style=color:#f92672>/</span>{<span style=color:#a6e22e>userId</span>}<span style=color:#f92672>/</span>{document<span style=color:#f92672>=**</span>} {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>allow</span> <span style=color:#a6e22e>read</span>, <span style=color:#a6e22e>update</span>, <span style=color:#66d9ef>delete</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>uid</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>userId</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>allow</span> <span style=color:#a6e22e>create</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>uid</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I&rsquo;ll run through what this means:</p><p><code>match /databases/{database}/documents {</code></p><p>When the subject runs our task, the task will request to write to a specific database. Here, <code>{database}</code> is filled in with this database, so this line essentially means that when a request comes in, it will only proceed if it matches the database we want to write to.</p><p><code>match /tasks/new_task/subjects/{userId} {</code></p><p>This then proceeds to the collection of documents I have for each subject. Each subject needs a document in the <code>subjects</code> collection (e.g. <code>/tasks/new_task/subjects/Subject123</code>).</p><p>In this line, the <code>{userID}</code> is filled in by the write request that the task sends whenever it tries to write data (this will be in the javascript code for the task, and we&rsquo;ll go over it below). This means it just looks for a document with the subject&rsquo;s ID.</p><p><code>allow read, update, delete: if request.auth.uid == userId;</code></p><p>If it finds a document that matches the subject&rsquo;s ID, this allows the request to read, update, and delete the data in this document.</p><p><code>allow create: if request.auth.uid != null;</code></p><p>If the subject ID doesn&rsquo;t match an existing document, this line gives it permission to create that document.</p><p>Together, this means that it looks for a document with the subject&rsquo;s ID, if it exists it&rsquo;s allowed to modify this document, if it doesn&rsquo;t exist it&rsquo;s only allowed to create a new document with that ID.</p><p><code>match /tasks/new_task/subjects/{userId}/{document=**} {</code></p><p>This line essentially does the same thing, but with the data contained within this subject&rsquo;s document. So if it finds a subject with an ID that matches that being submitted, it can modify collections/documents within that subject&rsquo;s document.</p><p>The overall function of these rules is to allow each subject to create data if it doesn&rsquo;t exist, but only to modify existing data if their ID matches the ID of the data they&rsquo;re trying to modify.</p><h3 id=authentication>Authentication</h3><p>In order to use these database rules, we need to provide each subject with a unique ID that Firebase can understand. The easiest way to do this is using Firebase&rsquo;s own authentication service. This is designed for logging people into apps etc, but works well for our purposes.</p><p>This is simple to set up - all we need to do is enable anonymous sign-ins. This means that we can give each subject an anonymous ID that will identify them within firebase.</p><p><img src=../../img/firebase_auth.png alt></p><p>To do this, go to the authentication tab on the left menu bar, then choose <strong>Sign-in method</strong> at the top. At the bottom of the list of sign-in providers, you&rsquo;ll see <strong>Anonymous</strong>. Just enable this and we&rsquo;re good to go.</p><h2 id=adding-firebase-database-to-a-task>Adding Firebase database to a task</h2><p>Once the Firebase database is set up, we need to tell our HTML/Javascript task to write data to it.</p><p>Detailed instructions for this can be found in the Firebase <a href=https://firebase.google.com/docs/web/setup>documentation</a></p><h3 id=html>HTML</h3><p>First we need to add some things to our HTML file (e.g. <code>index.html</code>) to tell it where to load the firebase code from. Then, we need to initialise Firebase. This means giving information about your database so that the script knows where it&rsquo;s supposed to find the database you&rsquo;ve created.</p><p>Thankfully, this is straightforward and firebase basically gives you something to copy and paste.</p><p>To get this, first go to <strong>project settings</strong>.</p><p><img src=../../img/firebase_settings.png alt></p><p>Then in the <strong>Your apps</strong> section, click on the <strong>&lt;/></strong> icon.</p><p><img src=../../img/firebase_apps.png alt></p><p>When asked to give your &ldquo;app&rdquo; a nickname, enter a name for the project. You don&rsquo;t need to select <strong>Firebase hosting</strong> for now.</p><p>Once you&rsquo;ve done this, you&rsquo;ll be given a code snippet to copy and paste into your HTML file, which will look something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!-- The core Firebase JS SDK is always required and must be listed first --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://www.gstatic.com/firebasejs/6.4.0/firebase-app.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- TODO: Add SDKs for Firebase products that you want to use
</span></span></span><span style=display:flex><span><span style=color:#75715e>     https://firebase.google.com/docs/web/setup#config-web-app --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://www.gstatic.com/firebasejs/6.4.0/firebase-firestore.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://www.gstatic.com/firebasejs/6.4.0/firebase-auth.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Your web app&#39;s Firebase configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>firebaseConfig</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>apiKey</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;dsfjdshu4wru3rwefufguds&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>authDomain</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;project.firebaseapp.com&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>databaseURL</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;https://project.firebaseio.com&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>projectId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;project&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>storageBucket</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;project.appspot.com&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>messagingSenderId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;83438438237409123&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>appId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;4:43344:web:256g4rfgdt3r23e&#34;</span>
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Initialize Firebase
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>firebase</span>.<span style=color:#a6e22e>initializeApp</span>(<span style=color:#a6e22e>firebaseConfig</span>);
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><h3 id=javascript>JavaScript</h3><p>Next there are a few things we&rsquo;ll need to add to any Javascript that we&rsquo;re using.</p><h4 id=enable-persistence>Enable persistence</h4><p>Normally, when we add data to our database, we send a request and the data is added immediately. If for some reason there is no internet connection (e.g. due to WiFi dropping) this will fail and we&rsquo;ll lose the data. Thankfully Firebase has functions to prevent this, which will retain the data and try to send it when the connection returns. We need to enable this however, which can be done with the following code (taken from <a href=https://stackoverflow.com/questions/54629892/web-app-firestore-cache-read-changed-documents-only>here</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>firebase</span>.<span style=color:#a6e22e>firestore</span>().<span style=color:#a6e22e>enablePersistence</span>()
</span></span><span style=display:flex><span>  .<span style=color:#66d9ef>catch</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>code</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;failed-precondition&#39;</span>) {
</span></span><span style=display:flex><span>          <span style=color:#75715e>// Multiple tabs open, persistence can only be enabled
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#75715e>// in one tab at a a time.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>code</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;unimplemented&#39;</span>) {
</span></span><span style=display:flex><span>          <span style=color:#75715e>// The current browser does not support all of the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#75715e>// features required to enable persistence
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      }
</span></span><span style=display:flex><span>  });
</span></span></code></pre></div><h4 id=create-a-user-id>Create a user ID</h4><p>As we covered earlier, each user needs a unique ID that identifies them in the database, and we create this using Firebase&rsquo;s authentication service.</p><p>This creates a global variable <code>uid</code> that identifies the user, and can be used in database queries.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Sign in
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>firebase</span>.<span style=color:#a6e22e>auth</span>().<span style=color:#a6e22e>signInAnonymously</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// User ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>uid</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// When signed in, get the user ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>firebase</span>.<span style=color:#a6e22e>auth</span>().<span style=color:#a6e22e>onAuthStateChanged</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>user</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>user</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>uid</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>uid</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h4 id=create-a-reference-to-the-database>Create a reference to the database</h4><p>We need to create a variable that refers to the database to allow us to interact with it.</p><p>This is quite simple:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>firebase</span>.<span style=color:#a6e22e>firestore</span>();
</span></span></code></pre></div><h4 id=creating-data>Creating data</h4><p>In my database, I start by creating a document for this subject usind their user ID.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>collection</span>(<span style=color:#e6db74>&#34;tasks&#34;</span>).<span style=color:#a6e22e>doc</span>(<span style=color:#e6db74>&#39;new_task&#39;</span>).<span style=color:#a6e22e>collection</span>(<span style=color:#e6db74>&#39;subjects&#39;</span>).<span style=color:#a6e22e>doc</span>(<span style=color:#a6e22e>uid</span>).<span style=color:#a6e22e>set</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>subjectID</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>subjectID</span>,  <span style=color:#75715e>// this refers to the subject&#39;s ID from prolific
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>date</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toLocaleDateString</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toLocaleTimeString</span>()
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>To break this down, <code>db.collection("tasks").doc('new_task').collection('subjects').doc(uid)</code> is a reference to the subject&rsquo;s document within the <strong>subjects</strong> collection for this task. Using the <code>.set()</code> method here sets the data contained within the subject&rsquo;s document to whatever is provided (in this case, it creates fields representing the subject ID, the date and time).</p><blockquote><p><strong><em>Note:</em></strong> <code>.set()</code> sets the contents of a chosen document to the values provided, removing any information that was there before</p></blockquote><h4 id=updating-data>Updating data</h4><p>If we want to update an existing field in a document at any point, we can use the <code>.update()</code> method. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>collection</span>(<span style=color:#e6db74>&#34;tasks&#34;</span>).<span style=color:#a6e22e>doc</span>(<span style=color:#e6db74>&#39;new_task&#39;</span>).<span style=color:#a6e22e>collection</span>(<span style=color:#e6db74>&#39;subjects&#39;</span>).<span style=color:#a6e22e>doc</span>(<span style=color:#a6e22e>uid</span>).<span style=color:#a6e22e>update</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>total_points</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>number_of_points</span>
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>This update a field in the subject&rsquo;s document containing some number of points.</p><blockquote><p><strong><em>Note:</em></strong> <code>.update()</code> updates existing values in a document</p></blockquote><p>The best way to add data as the subject completes your task will be dependent on the task itself, but it&rsquo;s fairly easy to figure it out using a combination of <code>.set()</code> and <code>.update()</code>.</p><h2 id=firebase-hosting>Firebase hosting</h2><p>Aside from the database, Firebase also provides an easy to use hosting service. There are plenty of alternatives to Firebase hosting, and <strong>you don&rsquo;t have to use Firebase hosting to use its database services</strong>.</p><p>To get started with hosting, click on the the hosting section on the left menu bar, and then click <strong>Get started</strong>. This will take you through a few installation steps.</p><p><img src=../../img/firebase_hosting_start.png alt></p><h3 id=installing-hosting-tools>Installing hosting tools</h3><p>Firebase hosting relies on some command line tools on your computer, which need to be installed through npm. Npm is a package manager that comes with Node.js (which can be downloaded <a href=https://nodejs.org/en/>here</a>).</p><p>Once you&rsquo;ve got npm installed, <code>npm install -g firebase-tools</code> should install all the Firebase tools. You can then click <strong>next</strong> on the Firebase hosting setup page (you can leave the box about adding the Javascript SDK unchecked).</p><p>Next, go to the directory containing your HTML/Javascript files. First, type</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firebase login
</span></span></code></pre></div><p>This will log you into your Google account.</p><p>Then, we can initialise Firebase and deploy the web page. First, make sure you have a directory that&rsquo;s organised properly. Essentially, you just need a top level directory that contains a directory called <code>public</code> containing your web page.</p><p>Once you have this, navigate to the top level directory and use the following command to set up the Firebase project.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firebase init
</span></span></code></pre></div><p>Then, when you&rsquo;re ready to deploy, run</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firebase deploy
</span></span></code></pre></div><p>And that&rsquo;s it, your task will be deployed at the url given in the <strong>Hosting</strong> section of the Firebase dashboard.</p><h2 id=collect-some-data>Collect some data</h2><p>That should be everything you need to get your task set up and running using Firebase, so you can test it out and start collecting data!</p><p>If anything here doesn&rsquo;t work please let me know, it&rsquo;s quite possible there are errors as this was a bit of a rushed job!</p></div></div></div><br><br><script src=/js/feather.min.js></script>
<script>feather.replace()</script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css></body></html>